-- models/intermediate/product/int_customer.sql

WITH PERSON AS (
    SELECT 
        BUSINESSENTITYID AS PERSONID, 
        CAST(PERSONTYPE AS VARCHAR(4)) AS PERSONTYPE, 
        --NAMESTYLE, --CAMPO DESCARTADO, SOMENTE CONTÉM O VALOR "FALSE"  
        CAST(TITLE AS VARCHAR(6)) AS TITLE, 
        CAST(CONCAT(FIRSTNAME, ' ', LASTNAME) AS VARCHAR(150)) AS NAME,
        --FIRSTNAME, -- CAMPO JÁ ESTÁ SENDO UTILIZADO/TRATADO
        --MIDDLENAME, -- CAMPO NÃO SERÁ UTILIZADO
        --LASTNAME, -- CAMPO JÁ ESTÁ SENDO UTILIZADO/TRATADO
        CAST(SUFFIX AS VARCHAR(5)) AS SUFFIX, 
        EMAILPROMOTION, 
        --ADDITIONALCONTACTINFO, --CAMPO DESCARTADO, SOMENTE CONTÉM O VALOR "[NULL]" 
        CAST(DEMOGRAPHICS AS VARCHAR(1000)) AS DEMOGRAPHICS, 
        CAST(ROWGUID AS VARCHAR(38)) AS ROWGUIDPERSON, 
        CAST(MODIFIEDDATE AS DATE) AS MODIFIEDDATEPERSON 
    FROM 
        {{ ref('stg_adventure_works__person') }}
),

CUSTOMER AS (
    SELECT 
        ORDER_CUSTOMER.CUSTOMERID, 
        ORDER_CUSTOMER.PERSONID, 
        --ORDER_CUSTOMER.STOREID, --CAMPO DESCARTADO, CONTÉM IDS E NÃO SERÁ CONTEMPLADO EM DIMENSÃO 
        --TERRITORYID, --CAMPO DESCARTADO, CONTÉM IDS E NÃO SERÁ CONTEMPLADO EM DIMENSÃO 
        CAST(ORDER_CUSTOMER.ROWGUID AS VARCHAR(38)) AS ROWGUIDCUSTOMER, 
        CAST(ORDER_CUSTOMER.MODIFIEDDATE AS DATE) AS MODIFIEDDATECUSTOMER,
        PERSON.PERSONTYPE, 
        PERSON.TITLE, 
        PERSON.NAME,
        PERSON.SUFFIX, 
        PERSON.EMAILPROMOTION,
        PERSON.DEMOGRAPHICS, 
        PERSON.ROWGUIDPERSON, 
        PERSON.MODIFIEDDATEPERSON  
    FROM 
        {{ ref('stg_adventure_works__customer') }} AS ORDER_CUSTOMER
    INNER JOIN PERSON
        ON PERSON.PERSONID = ORDER_CUSTOMER.PERSONID
)

SELECT * FROM CUSTOMER